(()=>{"use strict";class e{draw(e,t){const l=document.createElement("game-board");l.style.display="grid",l.style.gridTemplateColumns="repeat(8, 65px)",e.forEach((e=>{e.forEach((e=>{l.appendChild(e.createCell(t))}))}));const s=document.querySelector("game-board");s&&s.remove(),document.querySelector("container").appendChild(l)}}class t{index;row;value;element;constructor(e,t,l){this.index=e,this.row=t,this.value=l}createCell(e){return this.element=document.createElement("div"),this.element.style.height="65px",this.element.style.border="1px solid black",this.element.style.display="flex",this.element.style.alignItems="center",this.element.style.justifyContent="center",this.element.style.fontSize="25px",this.element.style.fontWeight="bold",this.element.style.cursor="pointer",this.element.innerHTML=this.value,this.element.setAttribute("cell-value",this.value),this.element.addEventListener("click",(()=>e(this))),this.element}}class l{getInitialState(){return Array.from({length:8},((e,l)=>Array.from({length:8},((e,s)=>new t(s,l,this.randomValue())))))}isTransitionValid(e,t){const l=Math.abs(e.row-t.row),s=Math.abs(e.index-t.index);return 1===l&&0===s||0===l&&1===s}getCombinations(e,{row:t,index:l,value:s}){const i=[],n=e[t];let a=[l];for(let e=l-1;e>=0&&n[e].value===s;e--)a.unshift(e);for(let e=l+1;e<8&&n[e].value===s;e++)a.push(e);a.length>=3&&i.push({id:t,type:"row",cellIds:a,bonus:a.length>4});let o=[t];for(let i=t-1;i>=0&&e[i][l].value===s;i--)o.unshift(i);for(let i=t+1;i<8&&e[i][l].value===s;i++)o.push(i);return o.length>=3&&i.push({id:l,type:"column",cellIds:o,bonus:o.length>4}),i}updateState(e,t){return t.forEach((({id:t,type:l,cellIds:s,bonus:i})=>{if(i&&"column"===l)for(let l=0;l<8;l++)e[l][t].value=this.randomValue();else s.forEach((s=>{if("row"===l){for(let l=s;l>0;l--)e[t][l].value=e[t][l-1].value;e[t][0].value=this.randomValue()}else{for(let l=s;l>0;l--)e[l][t].value=e[l-1][t].value;e[0][t].value=this.randomValue()}}))})),e}changeCells(e,t){const l=e.value;e.value=t.value,t.value=l,e.element.innerHTML=e.value,t.element.innerHTML=t.value,e.element.setAttribute("cell-value",e.value),t.element.setAttribute("cell-value",t.value)}randomValue(){return["A","B","C","D","E"][Math.floor(5*Math.random())]}}class s{extendCombinations(e){return e.map((e=>e.cellIds.length>3?{...e,bonus:!0,cellIds:(e.type,Array.from({length:8},((e,t)=>t)))}:e))}}class i{constructor(){}extendCombinations(e){return e.map((e=>({...e,score:30+20*(e.cellIds.length-3)})))}}class n{totalScore=0;logs=[];init(){this.createScoreLabel(),this.createScoreStatistic()}write(e){e.forEach((e=>{this.logs.push(this.mapCombinationToLogInfo(e)),this.totalScore+=e.score}))}mapCombinationToLogInfo({id:e,type:t,bonus:l,score:s}){return{move:`Move: ${t} - ${e}`,bonus:l?"Bonus Move!!!'}":"",score:s}}createScoreLabel(){const e=document.createElement("score-label");e.style.display="block",e.style.fontSize="40px",e.style.fontWeight="bold",e.innerHTML=`Score: ${this.totalScore}`,document.querySelector("container").appendChild(e)}createScoreStatistic(){const e=document.createElement("score-statistic");e.style.display="block",e.innerHTML='<div style="font-size: 30px; font-weight: bold">Statistics:<div>',document.querySelector("container").appendChild(e)}updateScore(){document.querySelector("score-label").innerHTML=`Score: ${this.totalScore}`}updateScoreStatistic(){if(0===this.logs.length)return;const e=document.querySelector("score-statistic");e.innerHTML='<div style="font-size: 30px; font-weight: bold">Statistics:<div>',this.logs.forEach((({move:t,bonus:l,score:s})=>{const i=document.createElement("div");i.style.whiteSpace="nowrap",i.innerHTML=`${t}${l?" - "+l:""} - ${s}`,e.appendChild(i)}))}}(new class{state=[];selectedCell=null;gameBoard=new e;gameState=new l;bonus=new s;score=new i;statistic=new n;startGame(){this.statistic.init(),this.state=this.gameState.getInitialState(),this.gameBoard.draw(this.state,this.handleCellClick.bind(this))}handleCellClick(e){if(!this.selectedCell||!this.gameState.isTransitionValid(this.selectedCell,e))return void(this.selectedCell=e);this.gameState.changeCells(this.selectedCell,e);let t=this.gameState.getCombinations(this.state,e);t=this.bonus.extendCombinations(t),t=this.score.extendCombinations(t),this.statistic.write(t),this.statistic.updateScore(),this.statistic.updateScoreStatistic(),this.state=this.gameState.updateState(this.state,t),this.gameBoard.draw(this.state,this.handleCellClick.bind(this)),this.selectedCell=null}}).startGame()})();