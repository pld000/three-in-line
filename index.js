(()=>{"use strict";class e{draw(e,t){const s=document.createElement("game-board");s.style.display="grid",s.style.gridTemplateColumns="repeat(8, 65px)",e.forEach((e=>{e.forEach((e=>{s.appendChild(e.createCell(t))}))}));const l=document.querySelector("game-board");l&&l.remove(),document.querySelector("container").appendChild(s)}}class t{index;row;value;element;constructor(e,t,s){this.index=e,this.row=t,this.value=s}createCell(e){return this.element=document.createElement("div"),this.element.style.height="65px",this.element.style.border="1px solid black",this.element.style.display="flex",this.element.style.alignItems="center",this.element.style.justifyContent="center",this.element.style.fontSize="25px",this.element.style.fontWeight="bold",this.element.style.cursor="pointer",this.element.setAttribute("cell-value",this.value),this.element.addEventListener("click",(()=>e(this))),this.element}}class s{getInitialState(){return Array.from({length:8},((e,s)=>Array.from({length:8},((e,l)=>new t(l,s,this.randomValue())))))}isTransitionValid(e,t){const s=Math.abs(e.row-t.row),l=Math.abs(e.index-t.index);return 1===s&&0===l||0===s&&1===l}getCombinations(e,{row:t,index:s,value:l}){const i=[],a=e[t];let n=[s];for(let e=s-1;e>=0&&a[e].value===l;e--)n.unshift(e);for(let e=s+1;e<8&&a[e].value===l;e++)n.push(e);n.length>=3&&i.push({id:t,type:"row",cellIds:n,bonus:n.length>4});let o=[t];for(let i=t-1;i>=0&&e[i][s].value===l;i--)o.unshift(i);for(let i=t+1;i<8&&e[i][s].value===l;i++)o.push(i);return o.length>=3&&i.push({id:s,type:"column",cellIds:o,bonus:o.length>4}),i}updateState(e,t){return t.forEach((({id:t,type:s,cellIds:l,bonus:i})=>{if(i&&"column"===s)for(let s=0;s<8;s++)e[s][t].value=this.randomValue();else l.forEach((l=>{if("row"===s){for(let s=l;s>0;s--)e[t][s].value=e[t][s-1].value;e[t][0].value=this.randomValue()}else{for(let s=l;s>0;s--)e[s][t].value=e[s-1][t].value;e[0][t].value=this.randomValue()}}))})),e}changeCells(e,t){const s=e.value;e.value=t.value,t.value=s,e.element.innerHTML=e.value,t.element.innerHTML=t.value,e.element.setAttribute("cell-value",e.value),t.element.setAttribute("cell-value",t.value)}randomValue(){return["A","B","C","D","E"][Math.floor(5*Math.random())]}}class l{extendCombinations(e){return e.map((e=>e.cellIds.length>3?{...e,bonus:!0,cellIds:(e.type,Array.from({length:8},((e,t)=>t)))}:e))}}class i{constructor(){}extendCombinations(e){return e.map((e=>({...e,score:30+20*(e.cellIds.length-3)})))}}class a{totalScore=0;logs=[];init(){this.createScoreLabel(),this.createScoreStatistic()}write(e){e.forEach((e=>{this.logs.push(this.mapCombinationToLogInfo(e)),this.totalScore+=e.score}))}mapCombinationToLogInfo({id:e,type:t,bonus:s,score:l}){return{move:`Move: ${t} - ${e}`,bonus:s?'<span style="color: red">Bonus Move!!!</span>':"",score:l}}createScoreLabel(){const e=document.createElement("score-label");e.style.display="block",e.style.fontSize="40px",e.style.fontWeight="bold",e.innerHTML=`Score: ${this.totalScore}`,document.querySelector("container").appendChild(e)}createScoreStatistic(){const e=document.createElement("score-statistic");e.style.display="block",e.innerHTML='<div style="font-size: 30px; font-weight: bold">Statistics:<div>',document.querySelector("container").appendChild(e)}updateScore(){document.querySelector("score-label").innerHTML=`Score: ${this.totalScore}`}updateScoreStatistic(){if(0===this.logs.length)return;const e=document.querySelector("score-statistic");e.innerHTML='<div style="font-size: 30px; font-weight: bold">Statistics:<div>',this.logs.forEach((({move:t,bonus:s,score:l})=>{const i=document.createElement("div");i.style.whiteSpace="nowrap",i.innerHTML=`${t}${s?" - "+s:""} - ${l}`,e.appendChild(i)}))}}(new class{state=[];selectedCell=null;gameBoard=new e;gameState=new s;bonus=new l;score=new i;statistic=new a;startGame(){this.statistic.init(),this.state=this.gameState.getInitialState(),this.gameBoard.draw(this.state,this.handleCellClick.bind(this))}handleCellClick(e){if(!this.selectedCell||!this.gameState.isTransitionValid(this.selectedCell,e))return void(this.selectedCell=e);this.gameState.changeCells(this.selectedCell,e);let t=this.gameState.getCombinations(this.state,e);t=this.bonus.extendCombinations(t),t=this.score.extendCombinations(t),this.statistic.write(t),this.statistic.updateScore(),this.statistic.updateScoreStatistic(),this.state=this.gameState.updateState(this.state,t),this.gameBoard.draw(this.state,this.handleCellClick.bind(this)),this.selectedCell=null}}).startGame()})();